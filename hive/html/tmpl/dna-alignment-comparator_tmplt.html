<!DOCTYPE html>
<html>

<script type="text/javascript" src="d3js/core/d3.js"></script>
<script type="text/javascript" src="d3js/d3js_basics.js"></script>
<script type="text/javascript" src="d3js/correlation_cords.js"></script>
<script type="text/javascript" src="d3js/parcoords_plot.js"></script>
<script type="text/javascript" src="d3js/venn_diagram.js"></script>
<script type="text/javascript" src="js/vjSVGView.js"></script>
<script src="js-obj-new/svc-alignment-comparator.js"></script> 

<script>
    $.loadLayoutManager();
    $.loadCSS('css/look_and_feel/velvet.css');
    $.loadScript('jsx/widgets/jquery/view/jquery.algoview.js');
    $.loadCSS('css/tabs.css');
</script>
<script> 
    document.write(algoViewHTMLSetUp(false));
</script>

<script type="application/javascript" language="JavaScript1.1" src="js/vjTableViewX2.js" ></script>
<script  src='js/vjPluggableToolbar.js'> </script>

<script>
google.load("visualization", "1", {packages:["corechart"]});

    // Set the DNA Pipeline title bar
    setLocationTitle("Alignment comparator");
    
    var algoProcess=new valgoProcess(docLocValue("id"),  "dna-alignment-comparator", "svc-alignment-comparator" );
    
    algoProcess.visibleParameters=["name","aligners","seqClassify", "entryExl"];
    
    algoProcess.submitButtonName="SUBMIT";
    algoProcess.docLocsToBorrow=["aligners","seqClassify"];
    algoProcess.recViewerName = 'DV_Parameter_view';

    vjDS.add("Loading annotation types ...","dsAnnotTypes","static://");
    vjDS["dsAnnotTypes"].parser = function (ds,text) {
        console.log(text);
        var recordV = vjDV[algoProcess.recViewerName];
        var collapseHitEl = recordV.getElement("collapseBy");//
        var outputIdEl = recordV.getElement("collapseID");

        if (text) {
            var txtSplit = text.split("\n");
            if (txtSplit.length) {
                collapseHitEl.fld.constraint_data = txtSplit.join("|");
                outputIdEl.fld.constraint_data = txtSplit.join("|");
            } else { // when there is only one type
                collapseHitEl.fld.constraint_data = text;
                outputIdEl.fld.constraint_data = text;
            }
        }
        recordV.redraw();
        return text;
    };

    // Set the function for whenever there is a change in the form 
    algoProcess.inputChanged = function(viewer,elem) {
        console.log("inputChanged");
        var recordV = vjDV[algoProcess.recViewerName];
        var annotToUse = recordV.getElement("annotationToUse");
        var collapseHitEl = recordV.getElement("collapseBy");//
        var outputIdEl = recordV.getElement("collapseID");

        if (annotToUse.value != "") {
            var val1 = viewer.getElementValue("annotationToUse","join");
            if (val1){
                vjDS["dsAnnotTypes"].reload("http://?cmd=ionAnnotTypes&fromComputation=0&cnt=-1&ionObjs=" + val1,true);
            }
        } else {
            collapseHitEl.fld.constraint_data = "transcript_id|gene_id|seqID";// "Please select an annotation file"
            outputIdEl.fld.constraint_data = "gene_name|transcript_name"; // "Please select an annotation file"
        }
        recordV.redraw();
    };
    
    algoProcess.callbackLoaded=function(viewer){
      console.log("inputloaded");
      return;
    };
    
    algoProcess.initialPresets={
         name:"> ",
         service:"svc-alignment-comparator"
    };
    
    gInitList += "alignCompInit();";
    function alignCompInit () {
        globalAlgo = $('#mainAlgoArea').algoview({
            algoObj: algoProcess,
            svcType: "svc-alignment-comparator",
            algoTitle: "Alignment comparator"
        });
     };
  
  
</script>

